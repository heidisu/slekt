---
import { getCollection, render, getEntries } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Container from "../../components/Container.astro";
import Title from "../../components/Title.astro";
import Timeline from "../../components/Timeline.astro";
import type { Item } from "../../types";

export async function getStaticPaths() {
  const personer = await getCollection("personer");
  return personer.map((person) => ({
    params: { id: person.id },
    props: { person },
  }));
}
const { person } = Astro.props;
const hendelser = person.data.hendelser
  ? await getEntries(person.data.hendelser)
  : [];
const navn = `${person.data.fornavn} ${person.data.etternavn}`
const upperFirstChar = (type: string) => type[0].toUpperCase() + type.slice(1)
const formatDate = (date: string) => new Date(date).toLocaleDateString("no-NB")
const items: Array<Item> = [
    { 
      title: "test",
      description: "sfdsfdsf",
      icon: "house"
    },
    { 
      title: "test",
      description: "sfdsfdsf",
      icon: "house"
    },
    { 
      title: "test",
      description: "sfdsfdsf",
      icon: "house"
    },
]

---

<Layout title={navn}>
  <Container>
  <Title>{navn}</Title>
  <div>
  <p>
    Født: {formatDate(person.data.født)}
  </p>

  <h2>Hendelser</h2>
  {
    hendelser.map((hendelse) => hendelse.data.kilde ? (
      <h3>{upperFirstChar(hendelse.data.type)}</h3>
      <p> 
        {hendelse.data.sted} {formatDate(hendelse.data.dato)}
      </p>
      <a href={hendelse.data.kilde.url}>{hendelse.data.kilde.tittel}</a>
    ) : 
    (<h3>{upperFirstChar(hendelse.data.type)}</h3>
      <p> 
        {hendelse.data.sted} {formatDate(hendelse.data.dato)}
        <br/>
        {hendelse.data.kommentar}
      </p>)
  )
  }
  </div>
  <Timeline items={items}/>
  </Container>
</Layout>
